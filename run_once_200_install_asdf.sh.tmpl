#!/bin/bash -e

{{ if eq .chezmoi.os "darwin" -}}
((brew info asdf | grep -i "not installed" 1>/dev/null) && brew install asdf) || echo "asdf already installed"
# Let's load asdf goodies now so that the user doesn't have to
# force re-open another shell just to load them.
. $(brew --prefix asdf)/asdf.sh
. $(brew --prefix asdf)/etc/bash_completion.d/asdf.bash
# Install python with the --enable-framework flag so that YouCompleteMe
# installs successfully. Note that asdf uses python-build (the same backend
# used by pyenv) to build and install Python. So the following env variable
# will be honored by asdf install python. Run `asdf --help python` for
# more information.
PYTHON_CONFIGURE_OPTS="--enable-framework"

{{ end -}}

# Install plugins
asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git
asdf plugin add erlang https://github.com/asdf-vm/asdf-erlang.git
asdf plugin-add rust https://github.com/asdf-community/asdf-rust.git
asdf plugin-add golang https://github.com/kennyp/asdf-golang.git

# Update plugins
asdf plugin update --all